# Power-Flow v0.2.0 Design: Michelin-Star Notion Integration

## Overview

v0.2 transforms flat Notion pages into visually stunning, information-rich entries with structured body content.

---

## What Changes

### v0.1 (Current)
- Creates page with **properties only**
- Page body is **empty**
- Plain text context (if any)

### v0.2 (Target)
- Creates page with properties **AND body content**
- Structured blocks: callout, toggle, bullets, divider
- **Priority-based visual styling**
- Collapsible source details
- Direct links back to Pocket

---

## Visual Design

### High Priority Action Item

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ðŸ”¥ Follow up with investor meeting                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                        â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚ ðŸ”¥ Context                               (red)  â”‚   â”‚
â”‚ â”‚ John mentioned he needs the deck by Friday.     â”‚   â”‚
â”‚ â”‚ He's presenting to the board on Monday and      â”‚   â”‚
â”‚ â”‚ wants time to review. This is time-sensitive.   â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                        â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                        â”‚
â”‚ â–¸ Source Details                                       â”‚
â”‚   â€¢ Recording: Investor call - Feb 5                   â”‚
â”‚   â€¢ Duration: 45:23                                    â”‚
â”‚   â€¢ Created: Feb 5, 2026 at 2:30 PM                    â”‚
â”‚   ðŸ”— Open in Pocket AI                                 â”‚
â”‚                                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Medium Priority Action Item

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âš¡ Research competitor pricing                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                        â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚ âš¡ Context                            (yellow)  â”‚   â”‚
â”‚ â”‚ Need to compare our pricing against the top 5   â”‚   â”‚
â”‚ â”‚ competitors. Look at their enterprise tiers     â”‚   â”‚
â”‚ â”‚ specifically.                                   â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                        â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                        â”‚
â”‚ â–¸ Source Details                                       â”‚
â”‚   â€¢ Recording: Morning brainstorm                      â”‚
â”‚   â€¢ Duration: 3:42                                     â”‚
â”‚   â€¢ Created: Feb 5, 2026 at 8:15 AM                    â”‚
â”‚   ðŸ”— Open in Pocket AI                                 â”‚
â”‚                                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Priority Style Map

| Priority | Icon | Callout Color | Notion Color Value |
|----------|------|---------------|-------------------|
| High | ðŸ”¥ | Red | `red_background` |
| Medium | âš¡ | Yellow | `yellow_background` |
| Low | ðŸ“ | Gray | `gray_background` |
| None/Unknown | ðŸ’¡ | Default | `default` |

---

## Block Structure

```python
def build_page_children(item: ActionItem) -> list[dict]:
    """Build the page body blocks for an action item."""
    children = []
    
    # 1. Context callout (priority-styled)
    if item.context:
        style = PRIORITY_STYLES.get(item.priority, PRIORITY_STYLES[None])
        children.append({
            "type": "callout",
            "callout": {
                "icon": {"type": "emoji", "emoji": style["icon"]},
                "color": style["color"],
                "rich_text": [{"type": "text", "text": {"content": safe_text(item.context)}}]
            }
        })
    
    # 2. Divider
    children.append({"type": "divider", "divider": {}})
    
    # 3. Source details toggle
    source_children = []
    
    if item.recording_title:
        source_children.append(create_bullet(item.recording_title, "Recording"))
    
    if item.duration_seconds:
        duration_str = format_duration(item.duration_seconds)
        source_children.append(create_bullet(duration_str, "Duration"))
    
    if item.created_at:
        date_str = item.created_at.strftime("%b %d, %Y at %I:%M %p")
        source_children.append(create_bullet(date_str, "Created"))
    
    if item.recording_url:
        source_children.append({
            "type": "paragraph",
            "paragraph": {
                "rich_text": [{
                    "type": "text",
                    "text": {"content": "ðŸ”— Open in Pocket AI", "link": {"url": item.recording_url}},
                    "annotations": {"color": "blue"}
                }]
            }
        })
    
    if source_children:
        children.append({
            "type": "toggle",
            "toggle": {
                "rich_text": [{"type": "text", "text": {"content": "Source Details"}}],
                "children": source_children
            }
        })
    
    return children
```

---

## Data Model Updates

### ActionItem (additions)

```python
@dataclass
class ActionItem:
    # Existing fields...
    
    # New in v0.2
    duration_seconds: Optional[int] = None  # Recording duration
    tags: list[str] = field(default_factory=list)  # From recording
```

### New Helper Functions

```python
def format_duration(seconds: int) -> str:
    """Format seconds as human-readable duration."""
    if seconds < 60:
        return f"{seconds}s"
    minutes, secs = divmod(seconds, 60)
    if minutes < 60:
        return f"{minutes}:{secs:02d}"
    hours, mins = divmod(minutes, 60)
    return f"{hours}:{mins:02d}:{secs:02d}"

def safe_text(text: str, max_length: int = 1900) -> str:
    """Safely truncate for Notion's 2000 char limit."""
    if not text:
        return ""
    if len(text) <= max_length:
        return text
    return text[:max_length - 3] + "..."
```

---

## Notion API Changes

### Create Page with Children

```python
def create_page(
    self,
    database_id: str,
    properties: dict,
    children: list[dict] = None
) -> dict:
    """Create a new page with optional body content."""
    payload = {
        "parent": {"database_id": database_id},
        "properties": properties,
    }
    if children:
        payload["children"] = children
    
    return self._request("POST", "/pages", json=payload)
```

---

## Sync Engine Changes

```python
# In sync.py
for item in action_items:
    if exists:
        result.skipped += 1
        continue
    
    if not dry_run:
        properties = item.to_notion_properties(property_map)
        children = item.to_notion_children()  # NEW
        self.notion.create_page(database_id, properties, children)
    
    result.created += 1
```

---

## Migration Path

### Existing Pages
- **No migration needed** â€” existing pages keep their (empty) bodies
- v0.2 only affects NEW pages created after upgrade
- Optional: future command `powerflow backfill` to add body content to existing pages

### Config Changes
- None required â€” body content is automatic

---

## Future Enhancements (v0.3+)

1. **Recording Pages**: Create parent recording pages with linked action items
2. **Incremental Sync**: Only fetch recordings since last_sync
3. **Batch Dedup**: Query multiple pocket_ids in one API call
4. **Tags Sync**: Map Pocket tags to Notion multi-select
5. **Transcript Excerpts**: Include relevant transcript quote in body
6. **Webhook Mode**: Real-time push on new Pocket recordings

---

## Testing Checklist

- [ ] High priority item: red callout, ðŸ”¥ icon
- [ ] Medium priority item: yellow callout, âš¡ icon
- [ ] Low priority item: gray callout, ðŸ“ icon
- [ ] No priority: default callout, ðŸ’¡ icon
- [ ] No context: callout omitted, divider + toggle only
- [ ] Long context (>2000 chars): truncated with "..."
- [ ] No recording URL: link paragraph omitted
- [ ] Toggle expands/collapses correctly
- [ ] Dedup still works (pocket_id check)
